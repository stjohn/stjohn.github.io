<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  	<title>@MfA: Python in the City</title>
    <link type="text/css" rel="stylesheet" href="../../lehman.css" />
  <style type="text/css">
  	li {
  		  padding-bottom:	10px ;
  }
  </style>
</head>
<body>

<div>
<div style =  "float:right">
<a href="https://www.mathforamerica.org">
<img style =  "height:60" src="mfaLogo.png"></a>
</div>


<h1>MfA Workshop: Python in the City<h1>
<h3>
<a href="https://stjohn.github.io">Katherine St. John</a><br>
<a href="https://www.mathforamerica.org/pdcatalog">Fall 2019</a></h3>

<p><i>What's the noisiest street in the city?  And which streets have the most collisions?  What trees are most commonly planted in the streets in your neighborhood?  What parts of the city are above the 100-year flood level?   We will explore these and related questions using Python and publicly available data about New York City.  This mini-course is organized into three sessions, each focused on a challenge, that introduces intermediate programming concepts using the Python programming language and popular packages that allow the analysis of structured data and the visualization via graphs and HTML navigable maps.  The workshop, via the challenges and variations, provides a multitude of scalable projects for use in the classroom.

<p>
<b>Prerequisites:</b> Assumes basic knowledge of Python:  familiarity with basic variable types (integers, real numbers, characters, strings and lists), input/output, definite loops (for-loop), and decisions.</i>


</div>

<div>
<h2>Session 1: Elevation Maps (Arrays & Images)</h2>
<h3> Wednesday, 6 November 2019</h3>

<p><img src="floodMap.png" width = "50%">

<p>Our first challenge is to build a 'flood map' of New York City metro area.  We start by exploring what data is needed and how to present the information, and then introduce the numerical analysis package, numpy,  to store grids (2 dimensional arrays) of elevations of the region.  We then use loops and decisions to traverse the array and create an image reflecting waterways and flood regions of the metropolitan are.   We introduce red-green-blue color codes to construct our flood maps.  The session ends with variations on the theme of maps based on elevations, slicing (accessing subsections of arrays), and representing colors in hexadecimal codes.



<ul>
	<li> <b>Slides:</b> <a href="mfa20191106.pdf">Session 1</a>
	<li> <b>Concepts covered:</b>   creating and traversing 2-dimensional arrays, decisions, data representation of colors (red-green-blue codes and hexadecimal codes).
	<li> <b>Packages used:</b>  <a href="https://numpy.org">numpy</a>, <a href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.html">matplotlib.pyplot</a>, both part of the freely-distributed <a href="https://www.anaconda.com/distribution/">anaconda </a> release of Python.	
	<li> <b>Data used:</b>
		<ul>
			<li> <a href="">Elevation data</a> from US National Oceanic and Atmospheric Administration (NOAA) <br>
				(Save as text, and remove 5 lines of metadata at top of file before using).
			<li> Cleaned dataset of NYC:  <a href="../../teaching/csci127/f17/elevationsNYC.txt">elevationsNYC.txt</a>.
		</ul>
	<li> <b>References:</b>
		<ul>
			<li> The flood maps exercise is based on an on-line lab for our introductory programming course (scroll halfway down):  <a href="../../teaching/csci127/f19/lab3.html">Lab 3</a>.
			<li> It was inspired by a Nifty program on <a href="http://nifty.stanford.edu/2016/franke-mountain-paths/">mountain paths</a> by Baker Franke.
			<li>  A lovely <a href="http://www.nytimes.com/newsgraphics/2012/1120-sandy/survey-of-the-flooding-in-new-york-after-the-hurricane.html?mcubz=1">visualization</a> of Hurricane Sandy flooding by the New York Times.
		</ul>
</ul>

</div>

<div>
<h2>Session 2: Analyzing City Data (Structured data & File I/O)</h2>
<h3> Wednesday, 20 November 2019</h3>

<p><img src="../../teaching/csci127/f17/nycHist.png" width="50%">

<p>The focus for the second meeting is analyzing structured data.  We will start with opening spreadsheets (CSV files) and graphing the data (a la Excel).  The opening challenge is on historical population data of New York City and answering questions such as:  how has the population changed over time?   What fraction of the population lives in your borough?  As well as demonstrating some of the basic statistics that are included (e.g. minimum, mean, correlation).  We then look at some data sets from <a href="https://opendata.cityofnewyork.us">NYC OpenData</a>:  daily school attendance, homeless shelter populations, parking tickets and 311 data.  Our follow-up questions include:  what days have the highest attendance at your school?  what color cars get the most parking tickets in your neighborhood?  What is the most common 311 complaint?  


<ul>
	<li> <b>Slides:</b> <a href="mfa20191120.pdf">Session 2</a>
	<li> <b>Concepts covered:</b>   file I/O, list (series) manipulation, basic statistics, binning data.
	<li> <b>Packages used:</b>  <a href="https://pandas.pydata.org">pandas</a>, <a href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.html">matplotlib.pyplot</a>, both part of the freely-distributed <a href="https://www.anaconda.com/distribution/">anaconda </a> release of Python.	 <br>
	Optional:  <a href="https://seaborn.pydata.org">seaborn</a> for lovely statistical data visualization.
	<li> <b>Data used:</b>  New York City historical population (wiki) and several datasets from NYC OpenData:   daily attendance,  homeless shelter data, 311 calls, and parking tickets.
	
		<ul>
			<li> Historical Population of New York City:
				<ul>
					<li> Wiki:  <a href="https://en.wikipedia.org/wiki/Demographic_history_of_New_York_City">Demographic history of New York City</a>
					<li> Cleaned data:  <a href="../../teaching/csci127/f17/nycHistPop.csv">nycHistPop.csv</a> 
				</ul>
			<li> 2018-2019 Daily Attendance:
				<ul>
					<li> Hosted at NYC OpenData: <a href="https://data.cityofnewyork.us/Education/2018-2019-Daily-Attendance/x3bb-kg5j">https://data.cityofnewyork.us/Education/2018-2019-Daily-Attendance/x3bb-kg5j</a>
					<li> <a href="https://github.com/stjohn/csci127/blob/master/dailyAttendanceManHunt2018.csv">Filtered data set</a> (for <a href="http://www.mhshs.org/hunter-college.html">Manhattan Hunter HS</a>)
				</ul>
			<li> Homeless Shelter:  <i>Did not have time to cover in slides, but included below for extra challenges:</i>
				<ul>
					<li> Go to: NYC OpenData: <a href="https://data.cityofnewyork.us/Social-Services/DHS-Daily-Report/k46n-sa2m">https://data.cityofnewyork.us/Social-Services/DHS-Daily-Report/k46n-sa2m</a>
					<li>
					Click on the "Explore Data/View Data" button.  To keep the data set from being very large (and avoid some missing values in 2014), we are going filter the data to be all counts after January 1, 2018.  To do this:
<ul>
	<li> Click on the "Filter" button.
	<li> On the menu that pops us, click on "Add a New Filter Condition".
	<li> Choose "Date of Census" but change the "is" to be "is after".
	<li> Click in the box below and a calendar will pop up.  Highlight January 1, 2018.
	<li> Click the check box to the left of the data.
	<li> It will take a few seconds (it's a large file) but the rows on the left
	will be filtered to be all counts after January 1, 2018.
</ul>
To download the file,
<ul>
	<li> Click on the "Export" button.
	<li> Under "Download", choose "CSV".
	<li> The download will begin automatically (files are usually stored in "Downloads" folder).
</ul>

				</ul>

			<li> Parking Tickets:
				<ul>
					<li> Hosted at NYC OpenData: <a  href="https://data.cityofnewyork.us/City-Government/Parking-Violations-Issued-Fiscal-Year-2020/pvqr-7yc4/data">https://data.cityofnewyork.us/City-Government/Parking-Violations-Issued-Fiscal-Year-2020/pvqr-7yc4/data</a>
					<li> Small sample file to work with:  <a href= "../../teaching/csci127/f17/tickets.csv">tickets.csv</a>
					<li> To download data for a given neighborhood (and restricted to just a single month or year, since the data sets can be quite large):
			<ul>
				<li> Instead of neighborhood name or zipcode, parking tickets are classified by the police precinct that issued the ticket.  First, figure out the precinct (here's a <a href="http://www1.nyc.gov/site/nypd/bureaus/patrol/find-your-precinct.page">useful tool</a>).
				<li> Download the data set as a CSV, filtering by "Violation Precinct."  For example, Hunter College is located in the 19th Precinct, so, you would enter <tt>19</tt> on the filter.

</ul>

				</ul>
				
			<li> NYC Film Permits:
				<ul>
					<li> Hosted at NYC OpenData:
						<a href="https://data.cityofnewyork.us/City-Government/Film-Permits/tg4x-b46p">https://data.cityofnewyork.us/City-Government/Film-Permits/tg4x-b46p</a>.
					<li> Since the files are quite large, use the "Filter" option and a range of dates for "StartDateTime" and "Export" (in CSV format) all permits for those dates.					
					<li> Filtered data set available on <a href="https://github.com/stjohn/csci127">github</a>.
				</ul>


				
				
				
			<li> 311 Calls:  <i>Did not have time to cover in slides, but included below for extra challenges:</i>
				<ul>
					<li> Hosted at NYC Open Data: <a href=https://data.cityofnewyork.us/Social-Services/311-Service-Requests-from-2010-to-Present/erm2-nwe9/data">https://data.cityofnewyork.us/Social-Services/311-Service-Requests-from-2010-to-Present/erm2-nwe9/data</a>

				</ul>					
		</ul>
<!--		
	<li> <b>References:</b>
		<ul>
			<li> LINK
			<li> LINK
		</ul>
-->
</ul>


</div>

<div>
<h2>Session 3: Mapping City Data (Using Objects & Mapping Coordinates)</h2>
<h3> Wednesday, 11 December 2019</h3>

<p><img src="collisions18Oct2016.png" width = "50%">

<p>Our opening challenge is: where do collisions occur?  For this last session, we focus on mapping GIS coordinates.  We introduce the folium package (a Python wrapper for leaflet.js) that makes interactive maps that be viewed in a browser (like <a href="https://maps.google/com">Google maps</a>).  We then discuss how to filter data to build maps of the locations, starting with the NYC public libraries.

We then work filtering the data, and plotting collisions by GIS locations and color coding by vehicles involved (did it involve a taxi?  a commercial vehicle?) and time.  <!--Our follow-up questions involve transferring these mapping techniques to other open NYC data sets.-->  Our second theme focuses on comparing and clustering based on distances between the data.  
We start with a challenge of finding catchment areas (Voronoi diagrams) for an
increasing number of libraries, and discuss different algorithms and their time complexity.  
We explore how the results change in terms of two common distances:  Euclidean (L2 metric) and taxicab (L1) metrics.  
Using the collion datasets, we next consider where k tow trucks should be placed at the start of rush hour to minimize delays (using k-means clustering).  

<ul>
	<li> <b>Slides:</b> <a href="mfa20191211.pdf">Session 3</a>
	<li> <b>Concepts covered:</b>  Using objects (instantiating and altering attributes), traversing data from files, review of coordinate systems and latitude and longitude, visualizing data (Voronoi diagrams and k-means clustering).   
	<li> <b>Packages used:</b>  
	turtle, pandas, & folium.  turtle is part of every Python distribution; 
	<a href="https://pandas.pydata.org">pandas</a> is included in the freely-distributed <a href="https://www.anaconda.com/distribution/">anaconda</a> release of Python.	
	<a href="https://pypi.org/project/folium/">folium</a>, a Python-wrapper for leaflet.js, is freely available.

	
	<li> <b>Data used:</b>  Locations of collisions in NYC, state math scores for NYC, NYC libraries (all from NY State or NYC open data projects).

		<ul>
			<li> Sample folium-generated map:  
			<p>
			<iframe src="../../teaching/csci127/f19/nycMap.html" width="600" height="400" frameborder="0" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
			
			<li> Collisions:
				<ul>
					<li>  Hosted at: <a href="https://data.cityofnewyork.us/Public-Safety/Motor-Vehicle-Collisions-Crashes/h9gi-nx95">https://data.cityofnewyork.us/Public-Safety/Motor-Vehicle-Collisions-Crashes/h9gi-nx95</a>
					
					<li>A sample file, <a href="../../teaching/csci127/f19/collisionsThHunterBday.csv">collisionsThHunterBday.csv</a> from 18 October 2016 was downloaded and can be used to test your program.
					<li> Map of the sample file (used <tt>tiles="Cartodb Positron"</tt> when creating the map.)

					<p><iframe src="../../teaching/csci127/f17/th.html" width="600" height="400" frameborder="0" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
					
					<li>And the same file using markers:
					<p><iframe src="thMark.html" width="600" height="400" frameborder="0" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
				</ul>
			<li> NYC Math Test Scores:
				<ul>
					<li> A geoJSON file with the NYC school district boundaries available from 
	<p><a href="https://www1.nyc.gov/site/planning/data-maps/open-data/districts-download-metadata.page">Open Data NYC Planning</a><p>
	(scroll down to "School, Police, Health & Fire" and export as geoJSON).
	
	<p>
	(If you have troubles downloading, here's the file:  <a href="../../teaching/seminar4/f17/schoolDistricts.json">schoolDistricts.json</a>).
	
	
					<li> Test scores for public schools available from:  
	<p><a href="http://schools.nyc.gov/Accountability/data/TestResults/ELAandMathTestResults">NYC Department of Education</a>
	<p>
	(download the <b>District</b> scores).
					<li> A choropleth map for NYC math scores by school district:
					<p>
					<p><iframe src="../../teaching/seminar4/s17/testScores.html" width="600" height="400" frameborder="0" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
				</ul>	
			<li> Libraries in NYC:
				<ul>
					<li> Hosted at NYC OpenData:  <a href = "https://data.cityofnewyork.us/Business/Library/p4pf-fyc4">https://data.cityofnewyork.us/Business/Library/p4pf-fyc4</a>
					<li>Voronoi diagram of libraries, overlaid on folium map:
					<p><iframe src="../../teaching/seminar4/s17/libVor.html" width="600" height="400" frameborder="0" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
				</ul>	
			<li> Data2Go:  <i>Did not have time to cover in slides, but included below for extra challenges:</i>
				<ul>
					<li> <a href="https://data2go.nyc">Data2Go</a>: an impressive collection of NYC data and maps (free but requires login)
					<li> <a href="https://www1.nyc.gov/site/planning/data-maps/open-data/districts-download-metadata.page">Community District Boundaries:</a> scroll down and download the geoJSON file.
					<li> NYC Community Districts, shaded by population:
					<p><iframe src="../../teaching/seminar4/s17/cd.html" width="600" height="400" frameborder="0" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
					<li> A sample program, <a href="../../teaching/seminar4/s17/cd.py">cd.py</a>, that makes a choropleth map based on the city's geoJSON map of community district boundaries and community district populations. The sample program adds extra rows for open space/parks since the geoJSON includes them, but almost all community district data files do not. The sample program includes some useful functions for aligning data from different sources.
				</ul>
		</ul>
		
	
	<li> <b>References:</b>
		<ul>
			<li> Voronoi diagrams: <a href="https://en.wikipedia.org/wiki/Voronoi_diagram">overview (wiki)</a>	and <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.Voronoi.html">scipy implementation</a>	
			<li> Fortune's algorithm:  <a href="https://link.springer.com/article/10.1007/BF01840357">original paper</a> and <a href="https://en.wikipedia.org/wiki/Fortune%27s_algorithm">overview (wiki)</a>
			<li> <a href="https://en.wikipedia.org/wiki/Delaunay_triangulation"> Delaunay Triangulations (wiki)</a>
			<li> Compare & contrast of <a href="https://iquantny.tumblr.com/post/137259799714/almost-one-third-of-nyc-is-not-patrolled-by-the">NYC Precinct Boundaries and Catchment Areas</a>
			<li> A  <a href="https://pythonprogramming.net/flat-clustering-machine-learning-python-scikit-learn/">walk-through</a> of k-means clustering in sk-learn
		</ul>
		

</ul>



</div>



</html>